#compdef sf

_arguments \
	'--org=[org name from config]:orgname:->org' \
	':command:(aura bulkQuery cancelDeploy chatter compile compileAndTest completions coverage createPackageXml createTraceFlag describe destroy execute list listFolder log proposeTests query retrieve metadata run show metadata status test toolingDelete toolingDeleteQuery toolingQuery toolingTest whoami info wipeCache)' \
	'--testLevel=[test level]:testlevel:(NoTestRun RunSpecifiedTests RunLocalTests RunAllTestsInOrg)' \
	'--checkOnly=[validate]:validate:(true false)' \
	'--runTests=[tests to run]:tests:->test' \
	'--verbose[be verbose and print all request and responses]:verbose:' \
	':file:_files'

case "$state" in
	org)
		local -a orgs
		orgs=("${(@f)$(jq --raw-output '.orgs | keys | .[]' ~/.sf/config)}")
		_values 'org' $orgs
		;;
	test)
		local -a tests
		tests=("${(@f)$(ls src/classes/*.cls | xargs basename | sed 's/.cls//')}")
		_values -s , 'test' $tests
		;;
esac

